<script src="js/jquery.js"></script>
<script src="js/index.js"></script>
<script>
	var url = 'https://s10459020.github.io/Knowledge/'
	var path = url + "Knowledge/" + (getPathQuery()? 
							getPathQuery():
							"");
							
	console.log({url, path});
</script>


<!doctype html>
<html>
	<head id="head">
		<link rel="stylesheet" type="text/css" href="Knowledge/index.css">
	</head>
	
	<body>
		<header id="header" class="body header"></header>

		<main id="main" class="body main">
			<section id="chapter"></section>
			<section id="option"></section>
		</main>
	</body>
</html>

<script> //header
	var pathSplit = path.split("/")
	var header = pathSplit[pathSplit.length-2];
	setHeader(header);
				
	console.log({pathSplit, header});
</script>
	
<script> // chapter	
	var data = "data.json";
	var dataType = "html"
	$.ajax({
		url: path + data,
		dataType : dataType
	})			
	.done(function(data){
		var json = parseJSON(data);
		
		json.forEach((e,i) => {
			chapter(e.title, e.content);
		});
	});
	
	console.log({pathSplit, header});
</script> 

<script> // option
	var contentsAPI = "https://api.github.com/repos/s10459020/Knowledge/contents";
	var contentsURL = (path)? (contentsAPI + "/" + path): (contentsAPI);
	$.ajax({ 
		url: contentsURL
		,dataType : "html"
		
	}).done(function(data){
		var rawList = $.parseJSON(data);
		
		var fileList = [];
		rawList.forEach( function(element){
			switch(element.name){
				case "css":
				case "js":
				case "main.json":
				case "imageNoFound.jpg":
					break;
				default:
					fileList.push(element.name);
			}
		});
		
		var articleList = {};
		fileList.forEach( function(element){
			var elementSplited = element.split(".");
			var name = elementSplited[0];
			var extension = elementSplited[1];
			switch(extension){
				// directory
				case undefined: 
					if (articleList[name] == undefined)
						articleList[name] = {};
					articleList[name]["directory"] = element;
					break;
					
				// image
				case "jpg":
				case "png":
				case "gif":
					if (articleList[name] == undefined)
						articleList[name] = {};
					articleList[name]["image"] = element;
					break;
				
				// content
				case "json":
					if (articleList[name] == undefined)
						articleList[name] = {};
					articleList[name]["content"] = element;
					break;
			}
		});
		
		Object.keys(articleList).forEach(function(key){
			
			// header
			var title = key;
			
			// image
			var imgSrc = (articleList[key]["image"]) 
				? (path + articleList[key]["image"])
				: ("imageNoFound.jpg");
			
		
		});
		
	}).fail(function(){
		console.log("get fileList fail");
	});
</script>