<script src="js/jquery.js"></script>
<script src="js/index.js"></script>
<script>
	var url = 'https://s10459020.github.io/Knowledge/'
	var path = "Knowledge/" + (getPathQuery()? 
							getPathQuery():
							"");
							
	console.log({url, path});
</script>


<!doctype html>
<html>
	<head id="head">
		<link rel="stylesheet" type="text/css" href="Knowledge/index.css">
	</head>
	
	<body>
		<header id="header" class="body header"></header>

		<main id="main" class="body main">
			<section id="chapter"></section>
			<section id="option"></section>
		</main>
	</body>
</html>

<script> //header
	var pathSplit = path.split("/")
	var header = pathSplit[pathSplit.length-2];
	setHeader(header);
				
	console.log({pathSplit, header});
</script>
	
<script> // main	
	var dataAjax = new Promise(function(resolve, reject) {
		var file = "data.json";
		var dataType = "json"
		var dataURL = url + path + file;
		
	  	$.when(
			$.ajax({url: dataURL, dataType : dataType}),
			
		).done(function(data){
			var list = [];
			
			data.forEach(function(e,i){
				if (e.type == "chapter") 
					list.push(new Chapter(e.title, e.content));
				else if (e.type == "option") 
					list.push(new Option(e.title, e.content, null, false));
			});
			
			resolve(list);
			
		}).fail(function(){
			console.log("dataAjax fail");
			resolve([]);
		});
	});



	var listAjax = new Promise(function(resolve, reject) {
		var contentsAPI = "https://api.github.com/repos/s10459020/Knowledge/contents";
		var dataType = "json"
		var listURL = contentsAPI + "/" + path;
		
	  	$.when(
			dataAjax,
			$.ajax({url: listURL, dataType : dataType})
			
		).done(function(list, data){
			console.log(data[0]);
			console.log(list);
			
			// image			
			data[0].forEach( function(e){
				var split = e.name.split(".");
				var name = split[0];
				var extension = split[1];
				
				switch(extension){
					case "jpg":
					case "png":
					case "gif":
						var option = Option.contain(list, name);
						if (option)
							option.image = e.name;
						else
							list.push(new Option(name, null, e.name, false));
				}
			});
			
			// directory
			data[0].forEach( function(e){
				if (e.type == "dir") {
					var option = Option.contain(list, e.name);
					if (option)
						option.link = true;
					else
						list.push(new Option(e.name, null, null, true));
				}
			});
			
			resolve(list);
			
		}).fail(function(list, data){
			console.log("listAjax fail");
			resolve(list);
		});
	});
	
	
	$.when(
		listAjax
		
	).done(function(list){
		console.log(list);
		list.forEach(function(e){
			//$("#main").append(e.getHTML());
		});
	});
</script> 